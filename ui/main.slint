import { PlayingState, MainBrowsingState, AlbumItem } from "global.slint";
import {
    MaterialWindow,
    SmallAppBar,
    NavigationBar,
    ModalNavigationDrawer,
    Vertical,
    ScrollView,
    Grid,
    FilledCard,
    Horizontal,
} from "material/material.slint";
import { Palette, AboutSlint } from "std-widgets.slint";

global NavBind {
    in-out property <int> nav-group;
    in-out property <int> nav-index;
}

component AlbumView inherits ScrollView {
    private property <length> card-size: 192px;
    private property <int> max-per-row: self.width / card-size;

    init => {
        MainBrowsingState.begin-reload-all-tracks();
    }

    changed width => {
        // on width update, also update the internal representation
        max-per-row = self.width / card-size;
    }

    GridLayout {
        for album[i] in MainBrowsingState.tracks: FilledCard {
                // square, with text afterward
                width: card-size;
            max-height: self.width + 36px;

            // determine row/col
                col: i.mod(max-per-row);
            row: i / max-per-row;

            // playing interaction
                    clickable: true;
            clicked => {
                        // TODO: add playing interaction
                    }

                    // album into
                    Vertical {
                alignment: start;

                Image {
                    source: album.album-art;
                    width: 100%;
                }

                Horizontal {
                    alignment: start;
                    padding: 0px;

                    Text {
                        text: album.title;
                    }
                }

                Horizontal {
                    alignment: start;
                    padding: 0px;

                    Text {
                        text: album.artist;
                        font-size: 8px;
                    }
                }

                Horizontal {
                    alignment: start;
                    padding: 0px;

                    Text {
                        text: album.album;
                        font-size: 8px;
                    }
                }
            }
        }
    }
}

export component MainWindow inherits MaterialWindow {
    default-font-family: "DejaVu Sans";
    preferred-height: 640px;
    preferred-width: 480px;
    title: "Mioplays";
    background: Palette.background;
    Vertical {
        appbar := SmallAppBar {
            title: "Mioplays";
            leading-button: { tooltip:"Menu", enabled:true };
            leading-button-clicked => {
                nav-drawer.show()
            }
        }

        AlbumView { }

        nav-drawer := ModalNavigationDrawer {
            current-group <=> NavBind.nav-group;
            current-index <=> NavBind.nav-index;
            width: root.width;
            height: root.height;
            x: 0;
            y: 0;

            groups: [{ title: "Main", items: [{ text: "Albums" }, { text:"Search" }] }];
        }
    }
}

export { MainBrowsingState, PlayingState, AlbumItem }
