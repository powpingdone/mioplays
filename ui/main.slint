export global MainBrowsingState { }

component MainBrowsing inherits Rectangle {
    background: white;
}

export global PlayerTabState {
    in property <image> album-art;
}

export global PlayingState {
    in property <bool> is-playing: false;
    callback play();
    callback pause();
    callback next();
}

// circle used to enclose buttons
component PathCircle inherits Path {
    stroke: blue;
    stroke-width: 5px;
    private property <int> w-mid: self.width / 2px;
    private property <int> w-hei: self.height / 2px;
    private property <int> midpoint: w-mid < w-hei ? w-mid : w-hei;

    MoveTo {
        x: midpoint;
        y: 0;
    }

    ArcTo {
        x: midpoint;
        y: parent.height / 1px;
        radius-x: midpoint;
        radius-y: midpoint;
    }

    ArcTo {
        x: midpoint;
        y: 0;
        radius-x: midpoint;
        radius-y: midpoint;
    }

    Close { }

    @children
}

// path based pause symbol, looks like ||
component PathPauseSymbol inherits Path {
    fill: brown;
    stroke: brown;
    stroke-width: 5px;
    private property <int> w-mid: self.width / 2px;
    private property <int> w-hei: self.height / 2px;
    private property <int> midpoint: w-mid < w-hei ? w-mid : w-hei;

    // bounds for the pause icon
    pure callback x-start() -> float;
    pure callback x-end() -> float;
    pure callback y-start() -> float;
    pure callback y-end() -> float;

    x-start => {
        midpoint * 42%
    }

    x-end => {
        midpoint * 58%
    }

    y-start => {
        midpoint * 30%
    }

    y-end => {
        midpoint * 70%
    }

    MoveTo {
        x: x-start();
        y: y-start();
    }

    LineTo {
        x: x-start();
        y: y-end();
    }

    Close { }

    MoveTo {
        x: x-end();
        y: y-start();
    }

    LineTo {
        x: x-end();
        y: y-end();
    }

    Close { }
}

// path based play symbol, looks like >
component PathPlaySymbol inherits Path {
    fill: brown;
    stroke: brown;
    stroke-width: 5px;
    private property <int> w-mid: self.width / 2px;
    private property <int> w-hei: self.height / 2px;
    private property <int> midpoint: w-mid < w-hei ? w-mid : w-hei;

    MoveTo {
        x: midpoint * 50%;
        y: midpoint * 50%;
    }

    LineTo {
        x: midpoint * 150%;
        y: midpoint;
    }

    LineTo {
        x: midpoint * 50%;
        y: midpoint * 150%;
    }

    Close { }
}

// path based "next song" symbol, like >>
component PathNextSymbol inherits Path {
    fill: brown;
    stroke: brown;
    stroke-width: 5px;
    private property <int> w-mid: self.width / 2px;
    private property <int> w-hei: self.height / 2px;
    private property <int> midpoint: w-mid < w-hei ? w-mid : w-hei;

    MoveTo {
        x: midpoint * 50%;
        y: midpoint * 50%;
    }

    LineTo {
        x: midpoint;
        y: midpoint;
    }

    LineTo {
        x: midpoint * 50%;
        y: midpoint * 150%;
    }

    Close { }

    MoveTo {
        x: midpoint * 90%;
        y: midpoint * 50%;
    }

    LineTo {
        x: midpoint * 140%;
        y: midpoint;
    }

    LineTo {
        x: midpoint * 90%;
        y: midpoint * 150%;
    }

    Close { }
}

component PlayerControls inherits Rectangle {
    background: red;

    VerticalLayout {
        HorizontalLayout {
            padding: 8px;
            // Play/Pause button
            TouchArea {
                PathCircle { }

                PathPauseSymbol {
                    visible: !PlayingState.is-playing;
                    height: parent.height * 60%;
                }

                PathPlaySymbol {
                    visible: PlayingState.is-playing;
                    height: parent.height * 60%;
                }

                // TODO: accessibilty here
                clicked => {
                    PlayingState.is-playing ? PlayingState.pause() : PlayingState.play();
                }
            }

            TouchArea {
                height: 95%;
                PathCircle { }

                PathNextSymbol {
                    height: parent.height * 60%;
                }

                clicked => {
                    PlayingState.next()
                }
                // TODO: accessibility roles here
            }
        }
    }
}

component PlayerTab inherits Rectangle {
    background: gray;
    vertical-stretch: 0.2;

    HorizontalLayout {
        Image {
            image-fit: ImageFit.fill;
            source: PlayerTabState.album-art;
        }

        PlayerControls { }

        Rectangle {
            Text {
                text: "Placeholder.";
            }
        }
    }
}

export component MainWindow inherits Window {
    preferred-height: 640px;
    preferred-width: 480px;
    GridLayout {
        Row {
            MainBrowsing { }
        }

        Row {
            PlayerTab {
                width: 100%;
                max-height: 75px;
            }
        }
    }
}
